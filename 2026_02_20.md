计划建立的数据表结构

所有核心数据 整合为一张"宽表" (Wide Table) ，命名为 strategy_data.csv。

这张表以日期 ( trade_date ) 为主键，每一行包含该日期的所有决策所需数据。

| 字段名 (Column Name) | 数据类型 | 来源/计算逻辑 | 对应策略用途 |
| --- | --- | --- | --- |
| trade_date | String/Date | Tushare 日历 | 时间对齐 |
| open | Float | 中证500ETF 510500 | 基础K线 |
| high | Float | 中证500ETF 510500 | 止损判断 (entry_high) |
| low | Float | 中证500ETF 510500 | 基础K线 |
| close | Float | 中证500ETF 510500 | 均线计算、收益计算 |
| volume | Float | 中证500ETF 510500 | 成交量 (辅助) |
| amount | Float | 中证500ETF 510500 | Heat_Z 热度计算 |
| ma_5 | Float | close.rolling(5).mean() | 支撑线 (MA_Support) |
| ma_10 | Float | close.rolling(10).mean() | 趋势线 (MA_Trend) |
| ma_20 | Float | close.rolling(20).mean() | 中期趋势 |
| ma_30 | Float | close.rolling(30).mean() | 长期防守线 (MA_Filter) |
| breadth | Float (0-100) | 每日统计(>MA20成分股占比) | 抄底/逃顶核心指标 |
| heat_z | Float | (amount - mean) / std | 资金热度 (过热卖出) |
| etf_turnover | Float (%) | (ETF_Vol / ETF_Share) | 首阴低吸过滤器 (>1.0%) |
|补充：换手率 (%) = (成交量vol / 基金流通额fd_share) * 100%，总份额在fund_share接口里的fd_share字段，一定要留意行情软件计算换手率时是用前一个交易日（T-1）的总份额作为分母，因为份额变动是在盘后公布。|

优点：

1. 易于回测 ：可以直接将这张表丢给回测引擎（如 Backtrader 或简单的 Pandas 循环），一行行遍历即可，无需关心数据对齐问题。

2. 高性能 ：预先计算好 MA (均线) 和 Heat_Z (热度) 等指标并存储，运行时直接读取，避免每次运行策略都重复计算，显著提升回测速度。

3. 清晰可读 ：打开 CSV 一眼就能看到每一天的所有状态：指数多少点？情绪多少分？资金热不热？非常直观。

实施步骤：

1. Data Fetcher : 编写一个脚本，分别拉取指数、ETF、成分股数据。

2. Data Processor :
   a) 计算 breadth (广度)。
   b) 计算 etf_turnover (换手率)。
   c) 计算 ma_x (均线) 和 heat_z 。

3. Data Merger : 将上述所有结果按 trade_date 合并，生成唯一的 strategy_data.csv 。
