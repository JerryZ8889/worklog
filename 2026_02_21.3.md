宽表字段与口径（14 字段）：
- trade_date：交易日（Tushare 交易日历）；
- open：中证500ETF开盘价（pro.index_daily）；
- high：中证500ETF最高价（pro.index_daily）；
- low：中证500ETF最低价（pro.index_daily）；
- close：中证500ETF收盘价（pro.index_daily）；
- volume：中证500ETF成交量（pro.index_daily）；
- amount：中证500ETF成交额（pro.index_daily）；
- ma_5：close.rolling(5).mean()；
- ma_10：close.rolling(10).mean()；
- ma_20：close.rolling(20).mean()；
- ma_30：close.rolling(30).mean()；
- breadth：每日"成分股收盘价 > MA20"占比（基于我们已准备的成分股与个股行情）；
- heat_z：Z_score = (amount – 过去20天的均值) / 标准差（基于ETF成交额）；
- etf_turnover：换手率(%) = (ETF vol / ETF fd_share) × 100%， 分母用 T-1 的 fd_share （fund_daily + fund_share）；

补充：
- 换手率分母：使用 T-1 份额 （fd_share.shift(1)），因为份额盘后公布；
- breadth：基于成分股 后复权 收盘价计算 MA20；
- 个股停牌：使用 后复权价格前向填充 ，保证 MA 连续性；
- 全表主键：trade_date；

因为涉及到ma_30，所以如果需要2019年1月1日展示字段全满的数据，就需要往前推30个交易日抓取数据，从2018年11月01日开始。

编写总表的promt（含有规则提示）：
- 数据来源Trshare Pro，API Key为"xxxxxxxxx"；
- 我们创建一个名为strategy_data.csv的文件作为总表；
- 总表需要保存的数据是从2019年1月1日延续至今，取值时可以往前多取1个交易日，为了某些公式需要；
- 总表内包含以下14个字段，如图所示；
- trade_date为主键；
- 每个时间段的中证500成分股来自表"csi500_components_schedule.csv"，每个时间点选之前最近的成分股发布日trade_date的成分股名单，直到下一次成分股调整；
- 成分股的个股数据来自"stocks_data"文件夹，全部从2018年11月1日开始；
- breadth的定义是当日股价站上20日均线的股票百分比，数据里每只股票的每一个交易日都有价格，没有缺失，数据已经清洗过了；
- ETF使用 510500.SH：
  - 抓取此ETF数据的价格使用后复权的计算方式；
  - 如遇到停牌日，采用前一日的后复权数据填充；
- Z-score的定义是"成交额"：（当天值-过去20天的均值）/标准差；
-  换手率 (%) = (成交量vol / 基金流通额fd_share) * 100%，总份额在fund_share接口里的fd_share字段，一定要留意行情软件计算换手率时是用前一个交易日（T-1）的总份额作为分母，因为份额变动是在盘后公布；
- 这个表里的字段有的可以直接拉取，有的需要计算，每只个股的数据是从2018年11月1日准备的，因此应对2019年1月1日开始的总表，即使有ma_30这个字段，应该也是可以满足；
- vol的单位以及amount的单位并不知道是多少，但是数值是与行情软件保持一致的；

AI建表后的逻辑回溯：（按刚写的13条逐条确认）：
- 1–3：数据源与日期区间满足：用 Tushare Pro，拉取区间从 2018-11-01 热身到今天，输出从 2019-01-01 起的交易日（首个交易日是 20190102）。实现见 build_strategy_data.py ；
- 4–5：总表字段 14 列且 trade_date 唯一：脚本输出固定 14 列，并已对 ETF 日线按 trade_date 去重，保证主键唯一。见 build_strategy_data.py ；
- 6：成分股切换规则正确：对每个 trade_date 取 asof_date <= trade_date 的最近一期成分股名单，直到下一次调整。见 build_strategy_data.py ；
- 7–8：个股数据来源与 breadth 定义一致：用 stocks_data/ 内收盘价计算 MA20，并统计 "close > MA20" 的占比。见 build_strategy_data.py ；
- 9：ETF=510500.SH，后复权 + 停牌前值填充已实现：后复权用 fund_div 现金分红构造累积因子；停牌日（volume=0 或 NaN）对 OHLC/volume/amount 前向填充。见 build_strategy_data.py ；
- 10：heat_z 口径正确： (amount - rolling20_mean) / rolling20_std 。见 build_strategy_data.py ；
- 11：换手率 T-1 分母已实现：先把 fd_share 前向填充，再 shift(1) 作为分母计算。见 build_strategy_data.py 。另外由于 vol 单位是"手"、 fd_share 单位是"万份"，按你写的 *(100%) 换算后数值等价于 vol / fd_share_T-1 （脚本目前就是这个等价形式）；
- 12：热身数据覆盖 MA30 与 rolling(20) 需求：从 20181101 开始拉取与计算，满足 201901 起的指标不缺失；
- 13：vol/amount 单位不强假设：脚本原样使用接口数值进行计算（不做额外缩放）；

已完成的产出：
- 已生成新的总表 strategy_data.csv ，共 1729 行 × 14 列，日期范围 20190102 ~ 20260213（均无空值）；
- 脚本输出文件名已改为 strategy_data.csv ，并补了 ETF 日线按 trade_date 去重。见 build_strategy_data.py ；
