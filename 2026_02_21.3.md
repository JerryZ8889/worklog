宽表字段与口径（14 字段）— 已按实际代码更新

> ⚠️ 数据源变更：OHLCV/均线/热度全部改为中证500**指数**（000905.SH），仅 etf_turnover 取自 510500 ETF。

- trade_date：交易日（Tushare 交易日历）；
- open：中证500**指数**开盘点位（`pro.index_daily`）；
- high：中证500**指数**最高点位（`pro.index_daily`）；
- low：中证500**指数**最低点位（`pro.index_daily`）；
- close：中证500**指数**收盘点位（`pro.index_daily`）；
- volume：中证500**指数**成交量（`pro.index_daily` 的 vol 字段重命名）；
- amount：中证500**指数**成交额（`pro.index_daily`）；
- ma_5：`close.rolling(5).mean()`；
- ma_10：`close.rolling(10).mean()`；
- ma_20：`close.rolling(20).mean()`；
- ma_30：`close.rolling(30).mean()`；
- breadth：每日"成分股收盘价 > MA20"占比（基于本地 stocks_data + csi500_components_schedule）；
- heat_z：Z_score = `(指数amount – 过去20天的amount均值) / 过去20天的amount标准差`；
- etf_turnover：`510500 ETF vol(手) / fd_share_T-1(万份)`（`fund_daily` + `fund_share`）；

补充：
- 数据源变更说明：指数数据天然全收益口径，**无需复权**，不需要 fund_div 构造复权因子、不需要停牌价格填充等 ETF 特有的处理逻辑；
- 换手率分母：使用 T-1 份额（`fd_share.ffill().shift(1)`），因为份额盘后公布；
- breadth：基于成分股后复权收盘价计算 MA20（个股复权在 stocks_data 准备阶段已完成）；
- 个股停牌：在 stocks_data 准备阶段已使用后复权价格前向填充，保证 MA 连续性；
- 全表主键：trade_date；

因为涉及到 ma_30 和 heat_z 的 rolling(20)，所以如果需要2019年1月1日展示字段全满的数据，就需要往前推30个交易日抓取数据，从2018年11月01日开始（`WARMUP_START = '20181101'`）。

编写总表的规则（对应 `build_strategy_data.py` v5）：
- 数据来源 Tushare Pro；
- 创建 `strategy_data.csv` 作为总表；
- 总表数据从2019年1月1日延续至今，热身数据从2018年11月1日开始；
- 总表内包含 14 个字段（如上所示）；
- trade_date 为主键；
- 每个时间段的中证500成分股来自 `csi500_components_schedule.csv`，每个时间点选之前最近的成分股发布日的成分股名单；
- 成分股的个股数据来自 `stocks_data/` 文件夹，全部从2018年11月1日开始；
- breadth 定义：当日股价站上20日均线的成分股百分比；
- **指数数据（OHLCV + amount）直接使用 `index_daily` 接口，无需复权**；
- ETF 仅用于计算换手率：`fund_daily`（vol）+ `fund_share`（fd_share），分母用 T-1；
- Z-score 基于**指数成交额**：(当天值 - 过去20天均值) / 标准差；
- vol 和 amount 的单位直接使用接口返回值，不做额外缩放；

AI建表后的逻辑回溯（按规则逐条确认）：
- 1–3：数据源与日期区间满足：用 Tushare Pro，**指数日线**从 2018-11-01 热身到今天，输出从 2019-01-01 起的交易日（首个交易日是 20190102）。实现见 `build_strategy_data.py` v5；
- 4–5：总表字段 14 列且 trade_date 唯一：脚本输出固定 14 列，并已对指数日线按 trade_date 去重，保证主键唯一；
- 6：成分股切换规则正确：对每个 trade_date 取 asof_date <= trade_date 的最近一期成分股名单，直到下一次调整；
- 7–8：个股数据来源与 breadth 定义一致：用 `stocks_data/` 内收盘价计算 MA20，并统计 "close > MA20" 的占比；
- 9：**数据源改为指数后，无需后复权和停牌填充处理**（之前 ETF 版本需要 fund_div 现金分红构造累积因子、volume=0 时 OHLC 前向填充）；
- 10：heat_z 口径正确：`(指数amount - rolling20_mean) / rolling20_std`；
- 11：换手率 T-1 分母已实现：先把 fd_share 前向填充（`ffill`），再 `shift(1)` 作为分母计算。vol 单位是"手"、fd_share 单位是"万份"，`etf_turnover = etf_vol / fd_share_t1`；
- 12：热身数据覆盖 MA30 与 rolling(20) 需求：从 20181101 开始拉取与计算，满足 201901 起的指标不缺失；
- 13：vol/amount 单位不强假设：脚本原样使用接口数值进行计算（不做额外缩放）；

已完成的产出：
- 已生成总表 `strategy_data.csv`，共 1729 行 × 14 列，日期范围 20190102 ~ 20260213（均无空值）；
- 脚本版本：`build_strategy_data.py` v5，数据源为指数 + ETF换手率的混合方案；
- 回测验证（`backtest.py`）：2019-01-01 ~ 2026-02-13 全周期策略收益 +184.83%，基准 +100.86%；2024-01-01 起策略收益 +106.24%，基准 +53.43%；
- 看板验证（`dashboard.py`）：Streamlit 决策看板已基于该数据表运行，包含 KPI 绩效、5 张参考图表、战术指令板、技术快照等模块。
