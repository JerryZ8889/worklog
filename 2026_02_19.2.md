以下是这个项目的另一个核心【数据字段】

1.  **核心行情数据 (OHLCV)**

源文件： sh.000905.csv (中证500指数)

1. date (交易日期)

- 作用 ：作为所有数据对齐的时间轴主键。

2. close (收盘价)

- 核心作用 ：

- 计算均线系统（MA5, MA10, MA30）。

- 判断趋势方向（ Is_Up ）。

- 计算策略收益率。

- 触发"首阴"信号（今日收盘 < 昨日收盘）。

3. high (最高价)

- 核心作用 ：

- 止损逻辑 ：用于记录买入后的"最高价 ( entry_high )"。如果持仓 5
天内收盘价未能突破该最高价，则触发时间止损卖出。

4. amount (成交额)

- 核心作用 ：

- 资金热度 ：用于计算 Heat_Z (成交额
Z-Score)，判断市场是否过热（>1.5σ）或过冷。

- 注意：代码使用的是成交额 (Amount) 而非成交量 (Volume)。

**二、 市场情绪数据 (Sentiment)**

源文件： csi500_breadth_daily.csv

5. breadth (市场广度)

- 定义 ：中证500成分股中，股价站上 20日均线 的股票占比（%）。

- 核心作用 ：

- 抄底信号 ：当 breadth < 16 时触发"复合反转模式"买入。

- 逃顶信号 ：当 breadth > 79 时触发过热卖出。

**三、 流动性数据 (Liquidity)**

源文件： CSI500_Master_Strategy.csv

6. ETF_Turnover (ETF换手率)

- 定义 ：中证500ETF (510500) 的换手率数据。

- 核心作用 ：

- 活跃度确认 ：在"首阴模式"下，要求 Turnover_Pct > 1.0
才能开仓，确保市场有足够的活跃资金承接。

总结：数据检查清单

  ---------------------------------------------------------------------------------
  字段名         中文名    来源文件      必须性    缺失后果
  -------------- --------- ------------- --------- --------------------------------
  date           日期      所有文件      ⭐⭐⭐    无法对齐数据，程序报错

  close          收盘价    指数行情      ⭐⭐⭐    无法计算信号和收益

  high           最高价    指数行情      ⭐⭐⭐    无法执行"5日不创新高"止损

  amount         成交额    指数行情      ⭐⭐⭐    无法计算热度，无法卖出过热单

  breadth        广度      广度文件      ⭐⭐⭐    无法判断冰点/高潮，策略失效

  ETF_Turnover   ETF换手   策略总表      ⭐⭐      无法确认首阴买点（会导致不买）
  ---------------------------------------------------------------------------------

注：代码中还读取了 open 、 low 和 volume 等字段，但在核心交易逻辑
run_strategy 函数中 并未直接使用 ，仅作为数据框的一部分存在。

**针对Tushare Pro，需要获得的数据字段整理如下：**

1.  指数日线行情 (中证500指数)

    a)  用途 ：计算策略收益、均线趋势、成交热度。

    b)  Tushare 接口 ： index_daily

    c)  目标代码 (ts_code) ： 000905.SH (中证500)

    d)  需要抓取的字段 ：

  ------------------------------------------------------------------
  Tushare 字段名     含义        对应本项目用途
  ------------------ ----------- -----------------------------------
  trade_date         交易日期    对齐时间轴 ( date )

  close              收盘点位    均线计算、趋势判断 ( close )

  high               最高点位    5日不创新高止损 ( high )

  amount             成交额      计算资金热度 Heat_Z ( amount )

  pre_close          昨收盘      (可选) 辅助验证涨跌幅
  ------------------------------------------------------------------

2.  市场广度数据 (需要自行计算)

    a)  用途 ：计算 breadth (股价 > MA20 的成分股占比)。

    b)  第一步：获取成分股列表

        i.  接口 ： index_weight (指数成分权重)

        ii. 参数 ： index_code='000905.SH'

        iii. 字段 ： con_code (成分股代码)

        iv. 注：成分股随时间变化，需要按月更新成分股列。最好是先做一张总表把每个月成分股固定下来。以后线上更新成分股的节点为每个月的第一天，以及6月、12月第二个周6的晚上10点

    c)  第二步：获取所有成分股的日线行情

        i.  接口 ： daily (个股日线)

        ii. 参数 ：传入上述所有 500 只成分股代码列表。

        iii. 字段 ：

             - ts_code (股票代码)；

             - trade_date (交易日期)；

             - close (收盘价)。

        iv. 计算逻辑 ：

            - 拉取这 500 只股票过去 N 天的数据。

            - 对每只股票计算 MA20 。

            - 对每一天，统计 close > MA20 的股票数量 /
              当日有效股票总数。

3.  ETF 交易数据 (流动性)

    a)  用途 ：计算 ETF_Turnover (换手率) 以确认首阴买点。

    b)  Tushare 接口 ： fund_daily (场内基金日线)

    c)  目标代码 (ts_code) ： 510500.SH (南方中证500ETF -
        规模最大最具代表性)

    d)  需要抓取的字段 ：

  -----------------------------------------------------------------
  Tushare 字段名          含义              对应本项目用途
  ----------------------- ----------------- -----------------------
  trade_date              交易日期          对齐时间轴

  amount                  成交额            辅助观察

  vol                     成交量            辅助观察

  close                   收盘价            辅助观察

  pre_close               昨日收盘价        辅助观察

  market_capital          总市值            (需额外计算)
  -----------------------------------------------------------------

- 注：Tushare 的 fund_daily 接口
  不直接提供换手率，需要手动计算，公式为： 换手率 (%) = (成交量vol /
  基金流通额fd_share) *
  100%，总份额在fund_share接口里的fd_share字段，一定要留意行情软件计算换手率时是用前一个交易日（T-1）的总份额作为分母，因为份额变动是在盘后公布。

总结： Tushare 脚本需要做这三件事

1. pro.index_daily(ts_code='000905.SH') -> 存为 sh.000905.csv

2. pro.fund_daily(ts_code='510500.SH') + pro.fund_nav -> 计算换手率
-> 存为 CSI500_Master_Strategy.csv 的一部分

3. pro.index_weight + pro.daily (500只股) -> 计算广度 -> 存为
csi500_breadth_daily.csv

备注：

1.  有个逻辑可能后续要验证：

在某一个时间段内，换手率数值到底是多少才是高，只检验绝对值是不是不够，例如以下场景：

  ---------------------------------------------------------------------------------------------------------------------------------------------
  **场景**   **当日换手率**   **当日成交额**   **Z-Score**   **策略解读**
  ---------- ---------------- ---------------- ------------- ----------------------------------------------------------------------------------
  **场景 A** **1.1%** (达标)  10.5亿元         **0.2**       **假动作**。虽然换手率过线了，但相比过去 20
                                               (极低)        天，资金并没有显著流入，可能只是正常的震荡。

  **场景 B** **1.1%** (达标)  **25 亿元**      **2.8**       **真突破**。换手率达标且资金热度爆炸，说明大资金正在猛烈进场，买入信号极其可靠。
                                               (极高)        
  ---------------------------------------------------------------------------------------------------------------------------------------------

考虑一下逻辑：

双重校验逻辑： if (turnover_pct > 1.0) and (heat_z > 1.5):

#真正的放量确认#

signal = "BUY (Strong Momentum)"

elif (turnover_pct > 1.0) and (heat_z <= 1.5):

#虽然换手率够了，但资金热度不足，判定为虚假繁荣#

signal = "OBSERVE (Weak Momentum)"

2.  fund_daily 接口可以返回的字段：

  ---------------------------------------------------------------------
  字段名                中文名                详细含义
  --------------------- --------------------- -------------------------
  ts_code               TS代码                基金代码

  trade_date            交易日期              交易日

  pre_close             昨收价                前一交易日的收盘价

  open                  开盘价                当日第一笔成交价格

  high                  最高价                当日成交的最高价格

  low                   最低价                当日成交的最低价格

  close                 收盘价                当日最后一笔成交价格

  change                涨跌额                收盘价 - 昨收价

  pct_chg               涨跌幅                (收盘价 - 昨收价) /
                                              昨收价 * 100

  vol                   成交量                当日成交的总手数

  amount                成交额（千元）        当日成交的总金额
  ---------------------------------------------------------------------

3.  fund_nav接口可以返回的字段：

  -------------------------------------------------------------------------------------------
  字段名           中文名          详细含义与用途
  ---------------- --------------- ----------------------------------------------------------
  ts_code          TS代码          基金代码 (如 510500.SH )

  ann_date         公告日期        基金公司发布净值的日期 (通常是 T+1 日，如 20260214)

  nav_date         净值日期        最重要的时间轴 ，对应交易日 (如
                                   20260213)。我们用这个字段跟行情表的 trade_date 对齐。

  unit_nav         单位净值        每一份基金当天的实际价值 (不含分红再投资)。

  accum_nav        累计净值        加上历史上所有分红后的净值，反映基金成立以来的真实收益。

  accum_div        累计分红        历史上每份基金累计分红的金额。

  net_asset        资产净值        基金当天的总资产 (单位：元)。

  total_netasset   合计资产净值    如果是分级基金，这里是母基金总资产；对于
                                   ETF，通常这就是总规模。

  adj_nav          复权净值        考虑分红拆分后的复权净值，用于计算长期收益率。

  update_flag      更新标记        0表示未修改，1表示修正过。
  -------------------------------------------------------------------------------------------

4.  fund_share 接口可以返回的字段

  ----------------------------------------------------------------
  字段名       中文名     详细含义与用途
  ------------ ---------- ----------------------------------------
  ts_code      TS代码     基金代码 (如 510500.SH )

  trade_date   交易日期   对应交易日 (如 20260213 )

  fd_share     基金份额   这是我们最需要的数据！ 单位是 万份 。

  fund_type    基金类型   标识为 ETF

  market       市场       标识为 SH (上交所)
  ----------------------------------------------------------------
